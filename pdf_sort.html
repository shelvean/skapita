<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>PDF Sort</title>
    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            margin: 0;
            padding: 20px;
            background: #f0f2f5;
        }

        .header {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
        }

        .toolbar {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
        }

        button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            background: #3498db;
            color: white;
            transition: all 0.3s;
            font-weight: 600;
        }

        button:hover {
            background: #2980b9;
            transform: translateY(-1px);
        }

        .preview-container {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            max-height: 70vh;
            overflow-y: auto;
            justify-content: center;
            align-items: center;
        }

        .page-thumbnail {
            position: relative;
            cursor: move;
            border: 2px solid transparent;
            transition: all 0.2s;
            box-shadow: 0 3px 6px rgba(0,0,0,0.1);
            border-radius: 8px;
            overflow: hidden;
            background: white;
        }

        .page-thumbnail:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .delete-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: #e74c3c;
            padding: 5px 10px;
            border-radius: 3px;
            border: none;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
        }

        .delete-btn:hover {
            background: #c0392b;
        }

        .add-blank {
            background: #27ae60;
            border: none;
            border-radius: 8px;
            width: 40px;
            height: 40px;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            box-shadow: 0 3px 6px rgba(0,0,0,0.1);
        }

        .add-blank:hover {
            background: #219a52;
            transform: scale(1.1);
            box-shadow: 0 5px 10px rgba(0,0,0,0.2);
        }

        .add-blank::before,
        .add-blank::after {
            content: '';
            position: absolute;
            background: white;
            transition: all 0.3s;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
        }

        .add-blank::before {
            width: 20px;
            height: 2px;
        }

        .add-blank::after {
            width: 2px;
            height: 20px;
        }

        .blank-page {
            background: #ecf0f1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-style: italic;
            color: #7f8c8d;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <h1 class="header">PDF Sort</h1>
    
  <div class="description">
    <div class="feature-highlight">
        
        <div class="feature-grid">
            <div class="feature-item">
                <span class="feature-icon">üîÑ</span>
                <h4>Drag-and-Drop Editing</h4>
                <p>Intuitively reorganize pages with precision</p>
            </div>
            <div class="feature-item">
                <span class="feature-icon">‚ùå</span>
                <h4>Instant Deletion</h4>
                <p>Remove unwanted pages with one click</p>
            </div>
            <div class="feature-item">
                <span class="feature-icon">üìë</span>
                <h4>Smart Page Insertion</h4>
                <p>Add context-aware blank pages seamlessly</p>
            </div>
            <div class="feature-item">
                <span class="feature-icon">üíé</span>
                <h4>Quality Preservation</h4>
                <p>Export original-resolution PDFs</p>
            </div>
        </div>
    </div>
</div>

<style>
.description {
    max-width: 1200px;
    margin: 2rem auto;
    padding: 2.5rem;
    background: #ffffff;
    border-radius: 16px;
    box-shadow: 0 8px 30px rgba(0,0,0,0.08);
    border: 1px solid #e0e7ff;
    text-align: center;
}

.feature-highlight h3 {
    font-family: 'Inter', sans-serif;
    font-weight: 700;
    color: #1a237e;
    font-size: 2.2rem;
    margin-bottom: 2.5rem;
    letter-spacing: -0.5px;
}

.feature-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 2rem;
    justify-content: center;
}

.feature-item {
    padding: 1.5rem;
    background: #f8f9ff;
    border-radius: 12px;
    transition: transform 0.3s ease;
}

.feature-item:hover {
    transform: translateY(-5px);
}

.feature-icon {
    display: block;
    font-size: 2.5rem;
    margin-bottom: 1rem;
    background: #1a237e;
    color: white;
    width: 60px;
    height: 60px;
    line-height: 60px;
    border-radius: 50%;
    margin: 0 auto 1.5rem;
}

.feature-item h4 {
    font-family: 'Inter', sans-serif;
    color: #2d3748;
    font-size: 1.3rem;
    margin-bottom: 0.8rem;
}

.feature-item p {
    color: #4a5568;
    font-size: 1rem;
    line-height: 1.5;
    margin: 0;
}
</style>
    
    <div class="toolbar">
        <input type="file" id="pdfInput" accept="application/pdf" multiple>
        <button onclick="clearAll()">Clear Files</button>
        <button onclick="savePDF()">Save PDF</button>
    </div>

    <div class="preview-container" id="previewContainer"></div>

    <script src="https://unpkg.com/pdfjs-dist@2.11.338/build/pdf.min.js"></script>
    <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>

    <script>
        let pdfDocs = [];
        let pages = [];
        let currentDraggedItem = null;

        document.getElementById('pdfInput').addEventListener('change', handleFileSelect);
        
        async function handleFileSelect(event) {
            const files = event.target.files;
            for (const file of files) {
                const arrayBuffer = await file.arrayBuffer();
                const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
                pdfDocs.push({ pdf, arrayBuffer });
                
                for (let i = 1; i <= pdf.numPages; i++) {
                    const page = await pdf.getPage(i);
                    const viewport = page.getViewport({ scale: 1 });
                    const scale = 0.5;
                    
                    const originalWidth = viewport.width;
                    const originalHeight = viewport.height;

                    const previewViewport = page.getViewport({ scale });
                    const canvas = document.createElement('canvas');
                    const context = canvas.getContext('2d');
                    canvas.height = previewViewport.height;
                    canvas.width = previewViewport.width;
                    
                    await page.render({ 
                        canvasContext: context, 
                        viewport: previewViewport 
                    }).promise;
                    
                    pages.push({ 
                        type: 'pdf', 
                        canvas,
                        pdfIndex: pdfDocs.length - 1,
                        pageNumber: i,
                        originalWidth,
                        originalHeight
                    });
                }
            }
            renderPreview();
        }

        function renderPreview() {
            const container = document.getElementById('previewContainer');
            container.innerHTML = '';

            if (pages.length === 0) {
                const addButton = createAddButton(0);
                container.appendChild(addButton);
                return;
            }

            pages.forEach((page, index) => {
                // Create page thumbnail
                const wrapper = document.createElement('div');
                wrapper.className = 'page-thumbnail';
                wrapper.draggable = true;
                wrapper.innerHTML = `
                    <div style="position: absolute; top: 5px; left: 5px; font-size: 12px; color: #666;">Page ${index + 1}</div>
                    <button class="delete-btn" onclick="deletePage(${index})">√ó</button>
                `;
                
                if (page.type === 'pdf') {
                    wrapper.appendChild(page.canvas);
                } else {
                    const blank = document.createElement('div');
                    blank.className = 'blank-page';
                    blank.style.width = `${page.originalWidth * 0.5}px`;
                    blank.style.height = `${page.originalHeight * 0.5}px`;
                    blank.textContent = 'Blank Page';
                    wrapper.appendChild(blank);
                }

                // Add insert button after page
                const addButton = createAddButton(index + 1);

                // Event listeners for drag and drop
                wrapper.addEventListener('dragstart', () => currentDraggedItem = index);
                wrapper.addEventListener('dragover', (e) => e.preventDefault());
                wrapper.addEventListener('drop', () => movePage(currentDraggedItem, index));

                container.appendChild(wrapper);
                container.appendChild(addButton);
            });

            // Add final insert button
            container.appendChild(createAddButton(pages.length));
        }

        function createAddButton(index) {
            const button = document.createElement('button');
            button.className = 'add-blank';
            button.onclick = () => addBlankPage(index);
            return button;
        }

        async function addBlankPage(index) {
            let width = 595;
            let height = 842;
            
            if (index > 0 && pages[index - 1]) {
                const prevPage = pages[index - 1];
                width = prevPage.originalWidth;
                height = prevPage.originalHeight;
            }

            const pdfDoc = await PDFLib.PDFDocument.create();
            const page = pdfDoc.addPage([width, height]);
            const bytes = await pdfDoc.save();
            const arrayBuffer = bytes.buffer;
            
            pages.splice(index, 0, { 
                type: 'blank', 
                originalWidth: width,
                originalHeight: height,
                arrayBuffer
            });
            
            renderPreview();
        }

        function movePage(fromIndex, toIndex) {
            const [movedPage] = pages.splice(fromIndex, 1);
            pages.splice(toIndex, 0, movedPage);
            renderPreview();
        }

        function deletePage(index) {
            pages.splice(index, 1);
            renderPreview();
        }

        async function savePDF() {
            const pdfDoc = await PDFLib.PDFDocument.create();
            
            for (const page of pages) {
                if (page.type === 'pdf') {
                    const originalPdf = await PDFLib.PDFDocument.load(pdfDocs[page.pdfIndex].arrayBuffer);
                    const [copiedPage] = await pdfDoc.copyPages(originalPdf, [page.pageNumber - 1]);
                    pdfDoc.addPage(copiedPage);
                } else {
                    const blankPdf = await PDFLib.PDFDocument.load(page.arrayBuffer);
                    const [blankPage] = await pdfDoc.copyPages(blankPdf, [0]);
                    pdfDoc.addPage(blankPage);
                }
            }
            
            const pdfBytes = await pdfDoc.save();
            const blob = new Blob([pdfBytes], { type: 'application/pdf' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'sorted-document.pdf';
            link.click();
        }

        function clearAll() {
            pdfDocs = [];
            pages = [];
            document.getElementById('previewContainer').innerHTML = '';
            document.getElementById('pdfInput').value = '';
        }
    </script>
</body>
</html>
