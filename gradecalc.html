<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Grades Statistics Calculator</title>
  <!-- Tailwind CSS CDN -->
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <!-- SheetJS CDN -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
</head>
<body>
  <div class="container mx-auto p-4 max-w-2xl">
    <h1 class="text-3xl font-bold mb-6 text-gray-800">Grade Statistics Calculator</h1>

    <!-- File Upload Input -->
    <div class="mb-6">
      <label for="file-upload" class="block text-sm font-medium text-gray-700 mb-2">
        Upload File (CSV, XLSX, TXT)
      </label>
      <input type="file" id="file-upload" accept=".csv,.xlsx,.txt" 
             class="mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 
                    file:rounded-md file:border-0 file:text-sm file:font-semibold 
                    file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
    </div>

    <!-- Column Title Input -->
    <div class="mb-6">
      <label for="column-title" class="block text-sm font-medium text-gray-700 mb-2">
        Column Title for Grades
      </label>
      <input type="text" id="column-title" placeholder="e.g., Final Score" 
             class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 focus:ring-blue-500 focus:border-blue-500">
    </div>

    <!-- Grade Ranges Inputs -->
    <div class="mb-6">
      <label class="block text-sm font-medium text-gray-700 mb-2">Grade Ranges</label>
      <div class="flex flex-wrap gap-4">
        <div>
          <label for="range-A" class="block text-sm font-medium text-gray-700">A</label>
          <input type="text" id="range-A" value="90-100" class="mt-1 block w-24 border-gray-300 rounded-md shadow-sm p-2" placeholder="e.g., 90-100">
        </div>
        <div>
          <label for="range-B" class="block text-sm font-medium text-gray-700">B</label>
          <input type="text" id="range-B" value="80-89" class="mt-1 block w-24 border-gray-300 rounded-md shadow-sm p-2" placeholder="e.g., 80-89">
        </div>
        <div>
          <label for="range-C" class="block text-sm font-medium text-gray-700">C</label>
          <input type="text" id="range-C" value="70-79" class="mt-1 block w-24 border-gray-300 rounded-md shadow-sm p-2" placeholder="e.g., 70-79">
        </div>
        <div>
          <label for="range-D" class="block text-sm font-medium text-gray-700">D</label>
          <input type="text" id="range-D" value="60-69" class="mt-1 block w-24 border-gray-300 rounded-md shadow-sm p-2" placeholder="e.g., 60-69">
        </div>
        <div>
          <label for="range-F" class="block text-sm font-medium text-gray-700">F</label>
          <input type="text" id="range-F" value="0-59" class="mt-1 block w-24 border-gray-300 rounded-md shadow-sm p-2" placeholder="e.g., 0-59">
        </div>
      </div>
    </div>

    <!-- Process Button -->
    <button id="process-btn" 
            class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-md transition duration-200">
      Process File
    </button>

    <!-- Results Display -->
    <div id="results" class="mt-6 p-6 bg-white shadow-md rounded-lg"></div>
  </div>

  <script>
    // Function to parse range string into min and max
    function parseRange(rangeStr) {
      const parts = rangeStr.trim().split('-');
      if (parts.length !== 2) {
        throw new Error('Invalid range format. Use "min-max", e.g., "90-100"');
      }
      const min = parseFloat(parts[0]);
      const max = parseFloat(parts[1]);
      if (isNaN(min) || isNaN(max) || min > max) {
        throw new Error('Invalid range values. Ensure min and max are numbers and min <= max');
      }
      return { min, max };
    }

    // Function to calculate the median
    function calculateMedian(grades) {
      const sorted = [...grades].sort((a, b) => a - b);
      const mid = Math.floor(sorted.length / 2);
      return sorted.length % 2 === 0 ? (sorted[mid - 1] + sorted[mid]) / 2 : sorted[mid];
    }

    // Function to calculate the standard deviation
    function calculateStdDev(grades) {
      const mean = grades.reduce((a, b) => a + b, 0) / grades.length;
      const variance = grades.reduce((a, b) => a + (b - mean) ** 2, 0) / (grades.length - 1);
      return Math.sqrt(variance);
    }

    // Function to count grades in each range based on user-defined ranges
    function countGrades(grades, ranges) {
      const counts = { A: 0, B: 0, C: 0, D: 0, F: 0 };
      for (const grade of grades) {
        if (grade >= ranges.A.min && grade <= ranges.A.max) counts.A++;
        else if (grade >= ranges.B.min && grade <= ranges.B.max) counts.B++;
        else if (grade >= ranges.C.min && grade <= ranges.C.max) counts.C++;
        else if (grade >= ranges.D.min && grade <= ranges.D.max) counts.D++;
        else if (grade >= ranges.F.min && grade <= ranges.F.max) counts.F++;
      }
      return counts;
    }

    // Event listener for the process button
    document.getElementById('process-btn').addEventListener('click', () => {
      const fileInput = document.getElementById('file-upload');
      const columnTitle = document.getElementById('column-title').value.trim();
      const resultsDiv = document.getElementById('results');

      // Clear previous results
      resultsDiv.innerHTML = '';

      // Get grade ranges
      let ranges;
      try {
        ranges = {
          A: parseRange(document.getElementById('range-A').value),
          B: parseRange(document.getElementById('range-B').value),
          C: parseRange(document.getElementById('range-C').value),
          D: parseRange(document.getElementById('range-D').value),
          F: parseRange(document.getElementById('range-F').value),
        };
      } catch (error) {
        resultsDiv.innerHTML = `<p class="text-red-500">${error.message}</p>`;
        return;
      }

      // Validation for file and column title
      if (!fileInput.files.length) {
        resultsDiv.innerHTML = '<p class="text-red-500">Please upload a file.</p>';
        return;
      }
      if (!columnTitle) {
        resultsDiv.innerHTML = '<p class="text-red-500">Please enter a column title.</p>';
        return;
      }

      const file = fileInput.files[0];
      const reader = new FileReader();

      reader.onload = function(e) {
        // Parse the file
        const data = e.target.result;
        const workbook = XLSX.read(data, { type: 'array' });
        const firstSheetName = workbook.SheetNames[0];
        const worksheet = workbook.Sheets[firstSheetName];
        const json = XLSX.utils.sheet_to_json(worksheet);

        // Check if file is empty or column title exists
        if (json.length === 0 || !(columnTitle in json[0])) {
          resultsDiv.innerHTML = '<p class="text-red-500">Column title not found or file is empty.</p>';
          return;
        }

        // Extract and filter numeric grades
        const grades = json
          .map(row => row[columnTitle])
          .filter(val => !isNaN(parseFloat(val)) && isFinite(val))
          .map(Number);

        if (grades.length === 0) {
          resultsDiv.innerHTML = '<p class="text-red-500">No numeric grades found in the specified column.</p>';
          return;
        }

        // Calculate number of students and mean
        const numberOfStudents = grades.length;
        const mean = grades.reduce((a, b) => a + b, 0) / numberOfStudents;

        // Calculate other statistics
        const max = Math.max(...grades);
        const min = Math.min(...grades);
        const median = calculateMedian(grades);
        const stdDev = calculateStdDev(grades);
        const counts = countGrades(grades, ranges);

        // Calculate total GPA points and average GPA
        const totalGpaPoints = (counts.A * 4.0) + (counts.B * 3.0) + (counts.C * 2.0) + (counts.D * 1.0) + (counts.F * 0.0);
        const averageGpa = totalGpaPoints / numberOfStudents;

        // Display results with user-defined ranges
        resultsDiv.innerHTML = `
          <h2 class="text-xl font-semibold mb-4 text-gray-800">Results</h2>
          <p><span class="font-medium">Number of Students:</span> ${numberOfStudents}</p>
          <p><span class="font-medium">Mean:</span> ${mean.toFixed(2)}</p>
          <p><span class="font-medium">Maximum:</span> ${max}</p>
          <p><span class="font-medium">Minimum:</span> ${min}</p>
          <p><span class="font-medium">Median:</span> ${median}</p>
          <p><span class="font-medium">Standard Deviation:</span> ${stdDev.toFixed(2)}</p>
          <p><span class="font-medium">Number of As (${ranges.A.min}-${ranges.A.max}):</span> ${counts.A}</p>
          <p><span class="font-medium">Number of Bs (${ranges.B.min}-${ranges.B.max}):</span> ${counts.B}</p>
          <p><span class="font-medium">Number of Cs (${ranges.C.min}-${ranges.C.max}):</span> ${counts.C}</p>
          <p><span class="font-medium">Number of Ds (${ranges.D.min}-${ranges.D.max}):</span> ${counts.D}</p>
          <p><span class="font-medium">Number of Fs (${ranges.F.min}-${ranges.F.max}):</span> ${counts.F}</p>
          <p><span class="font-medium">Average GPA:</span> ${averageGpa.toFixed(2)}</p>
        `;
      };

      // Read the file as an ArrayBuffer
      reader.readAsArrayBuffer(file);
    });
  </script>
</body>
</html>
